{"name":"RxSmartLock","tagline":"Reactive extension for Google's Smart Lock for Passwords API","body":"# RxSmartLock\r\nReactive extension for Google's [Smart Lock for Passwords API][1].\r\n\r\n[![API](https://img.shields.io/badge/API-9%2B-blue.svg?style=flat)](https://android-arsenal.com/api?level=9)\r\n[![Build Status](https://travis-ci.org/ShlMlkzdh/RxSmartLock.svg?branch=master)](https://travis-ci.org/ShlMlkzdh/RxSmartLock)\r\n[![Android Arsenal](https://img.shields.io/badge/Android%20Arsenal-RxSmartLock-orange.svg?style=true)](https://android-arsenal.com/details/1/2977)\r\n\r\n## Introduction\r\n[Sebastiano Poggi][5] has written a fantastic blog post on Smart Lock. Read it [here][6].\r\n\r\n## Usage\r\n\r\nIn order to use **RxSmartLock**, create a `SmartLock` object using the `SmartLock.Builder` class in the `onCreate` method of your `Activity`:\r\n\r\n```java\r\npublic class MainActivity extends AppCompatActivity {\r\n\r\n    private SmartLock mSmartLock;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        \r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_main);\r\n\r\n        mSmartLock = new SmartLock.Builder(this)\r\n                .setAccountTypes(IdentityProviders.GOOGLE, IdentityProviders.FACEBOOK) // Use the constants defined in IdentityProviders to specify commonly-used sign-in providers.\r\n                .setPasswordLoginSupported(true) // Used for password-based sign-in.\r\n                .build();\r\n\r\n    }\r\n\r\n}\r\n```\r\nNow you are ready to use **RxSmartLock**.\r\n\r\n### Retrieve a User's Stored Credentials\r\n\r\nAutomatically sign users into your app by using the Credentials API to request and retrieve stored credentials for your users.\r\n\r\nTo request stored credentials, call the `retrieveCredential()` method on the `SmartLock` object that you created from anywhere in your `Activity`. This method returns an observabale `Observable<Credential>` which you can subscribe to:\r\n```java\r\nmSubscription = mSmartLock.retrieveCredential().subscribe(new Subscriber<Credential>() {\r\n\r\n    @Override\r\n    public void onCompleted() {\r\n\r\n    }\r\n\r\n    @Override\r\n    public void onError(Throwable e) {\r\n\r\n        // Handle unsuccessful and incomplete credential requests.\r\n        if (e instanceof StatusException) {\r\n            Status status = ((StatusException) e).getStatus();\r\n            if (status.hasResolution()) {\r\n                // Prompt the user to choose a saved credential; do not show the hint selector.\r\n                try {\r\n                    status.startResolutionForResult(MainActivity.this, CREDENTIAL_REQUEST_RC);\r\n                } catch (IntentSender.SendIntentException e1) {\r\n                    Log.e(TAG, \"STATUS: Failed to send resolution.\");\r\n                }\r\n            } else {\r\n                // The user must create an account or sign in manually.\r\n                Log.e(TAG, \"STATUS: Unsuccessful credential request.\");\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    @Override\r\n    public void onNext(Credential credential) {\r\n        // On a successful credential request, use the resulting Credential object to complete the user's sign-in to your app.\r\n    }\r\n\r\n});\r\n```\r\nWhen user input is required to select a credential, the `Status.hasResolution()` method returns `true`. In this case, call the status object's `startResolutionForResult()` method to prompt the user to choose an account. Then, retrieve the user's chosen credentials from the activity's `onActivityResult()` method by calling the `retrieveCredentialFromIntent(Intent)` method on the `SmartLock` object that you created. This method returns an observabale `Observable<Credential>` which you can again subscribe to:\r\n\r\n```java\r\n@Override\r\nprotected void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n        \r\n    super.onActivityResult(requestCode, resultCode, data);\r\n        \r\n    if (requestCode == CREDENTIAL_REQUEST_RC) {\r\n        if (resultCode == RESULT_OK) {\r\n            mSmartLock.retrieveCredentialFromIntent(data).subscribe(new Action1<Credential>() {\r\n                @Override\r\n                public void call(Credential credential) {\r\n                    // On a successful credential request, use the resulting Credential object to complete the user's sign-in to your app.\r\n                }\r\n            });\r\n        } else {\r\n            Log.e(TAG, \"Credential Read: NOT OK\");\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nFor more information, check out the [official documentaion][2] on how to handle successful credential requests.\r\n\r\n### Store a User's Credentials\r\n\r\nAfter users successfully sign in, create accounts, or change passwords, allow them to store their credentials to automate future authentication in your app.\r\n\r\nTo save users' credentials, you can call the `storeCredential(Credential)` method on the `SmartLock` object that you created from anywhere in your `Activity`. This method returns an observabale `Observable<Boolean>` which you can subscribe to:\r\n```java\r\nmSubscription = mSmartLock.storeCredential(credential).subscribe(new Subscriber<Boolean>() {\r\n            \r\n    @Override\r\n    public void onCompleted() {\r\n      \r\n    }\r\n\r\n    @Override\r\n    public void onError(Throwable e) {\r\n    \r\n        // Try to resolve the save request. \r\n        // This will prompt the user if the credential is new.\r\n        if (e instanceof StatusException) {\r\n            Status status = ((StatusException) e).getStatus();\r\n            if (status.hasResolution()) {\r\n                try {\r\n                    status.startResolutionForResult(MainActivity.this, CREDENTIAL_STORE_RC);\r\n                } catch (IntentSender.SendIntentException e1) {\r\n                    Log.e(TAG, \"STATUS: Failed to send resolution.\");\r\n                }\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    @Override\r\n    public void onNext(Boolean aBoolean) {\r\n    \r\n        if (aBoolean) {\r\n            // We have successfully saved the user's credential.\r\n        }\r\n        \r\n    }\r\n            \r\n});\r\n```\r\n\r\nIf the call to `SmartLock.storeCredential(Credential)` is not immediately successful, the credentials might be new, in which case the user must confirm the save request. Resolve the save request with `startResolutionForResult()` to prompt the user for confirmation.\r\n\r\n```java\r\n@Override\r\nprotected void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n\r\n    super.onActivityResult(requestCode, resultCode, data);\r\n\r\n    if (requestCode == CREDENTIAL_STORE_RC) {\r\n        if (resultCode == RESULT_OK) {\r\n            Log.d(TAG, \"SAVE: OK\");\r\n        } else {\r\n            Log.e(TAG, \"SAVE: Canceled by user.\");\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nTo learn more about how to store a user's credentials, check out the [official documentaion][3].\r\n\r\n### Delete Stored Credentials\r\n\r\nDelete credentials from Smart Lock when either of the following circumstances occur:\r\n\r\n- Signing in with the credentials fails because the account no longer exists or the password is incorrect.\r\n- The user completes the app's account deletion flow.\r\n\r\nTo delete credentials, you can call the `deleteCredential(Credential)` method on the `SmartLock` object that you created from anywhere in your `Activity`. This method returns an observabale `Observable<Boolean>` which you can subscribe to:\r\n```java\r\nmSubscription = mSmartLock.deleteCredential(credential).subscribe(new Subscriber<Boolean>() {\r\n            \r\n    @Override\r\n    public void onCompleted() {\r\n      \r\n    }\r\n\r\n    @Override\r\n    public void onError(Throwable e) {\r\n    \r\n        // Handle unsuccessful deletion.\r\n        if (e instanceof StatusException) {\r\n            Status status = ((StatusException) e).getStatus();\r\n            Log.e(TAG, status.getStatusMessage());\r\n        }\r\n        \r\n    }\r\n\r\n    @Override\r\n    public void onNext(Boolean aBoolean) {\r\n    \r\n        if (aBoolean) {\r\n            // Credential was deleted successfully.\r\n        }\r\n        \r\n    }\r\n            \r\n});\r\n```\r\n\r\n### Google Play Services Connection Failures Handling\r\n\r\nSince [Smart Lock for Passwords][1] is a Google Play Services API, we need to handle possible connection failures when the connection to Google Play services fails or becomes suspended. This is how you can deal with these situtations gracefully when using **RxSmartLock**:\r\n\r\n```java\r\n@Override\r\npublic void onError(Throwable e) {\r\n\r\n    if (e instanceof ConnectionSuspendedException) {\r\n        int errorCode = ((ConnectionSuspendedException) e).getCode();\r\n        // Handle the connection suspension errors here.\r\n    }\r\n\r\n}\r\n```\r\n\r\n```java\r\n@Override\r\npublic void onError(Throwable e) {\r\n\r\n    if (e instanceof ConnectionException) {\r\n        ConnectionResult result = ((ConnectionException) e).getConnectionResult();\r\n        // Handle the connection failed errors here.\r\n        if (result.hasResolution()) {\r\n            result.startResolutionForResult(MainActivity.this, RESULT_RC);\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nYou can find more information on how to handle connection failures [here][4].\r\n\r\n## Add RxSmartLock To Your Project\r\n\r\nAdd this to your **build.gradle** file:\r\n```java\r\ndependencies {\r\n     compile 'com.shlmlkzdh:rx-smart-lock:1.1.4'\r\n}\r\n```\r\n\r\n## Additional Notes\r\n\r\nThis library is inspired by the [ReactiveLocation library for Android][7] developed by [Micha≈Ç Charmas][8] and a great [blog post][6] written by [Sebastiano Poggi][5] on Smart Lock. Thank you guys!\r\n\r\n## License\r\n\r\n```\r\nCopyright 2015 Soheil Malekzadeh\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n```\r\n\r\n [1]: https://developers.google.com/identity/smartlock-passwords/android/\r\n [2]: https://developers.google.com/identity/smartlock-passwords/android/retrieve-credentials\r\n [3]: https://developers.google.com/identity/smartlock-passwords/android/store-credentials\r\n [4]: https://developers.google.com/android/guides/api-client\r\n [5]: https://medium.com/@seebrock3r\r\n [6]: https://medium.com/@seebrock3r/login-experiences-that-don-t-suck-a42fade07067\r\n [7]: https://github.com/mcharmas/Android-ReactiveLocation\r\n [8]: https://github.com/mcharmas\r\n","google":"UA-71533204-1","note":"Don't delete this file! It's used internally to help with page regeneration."}